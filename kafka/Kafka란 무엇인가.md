# Kafka 란 무엇인가?

## 동작 방식과 원리

- 기본적으로 메시징 서버로 동작한다.
    - 메시지는 데이터 단위를 보내는 측(publisher / producer) 이랑 가져가는 측(subscriber / consumer) 이 있다.
    - 메시지를 보내고 받아서 pub/sub 모델이라고 함
- 중간에 메시지 시스템이 존재하고, 이를 통해 메시지를 보내고 가져간다.
    - 이렇게 되면 주거나 받는 쪽에 문제가 있어도 한 번 전달된 메시지가 유실되지 않는다.
        - 그리고 문제가 있는 친구가 회복되면 다시 가져갈 수 있다.
    - 메시징 시스템을 중심으로 연결되기 때문에 확장성이 용이하다.
- pub/sub 의 단점은 직접 통신하는 것은 아니기 때문에 코드가 복잡해지고 중간에 하나 시스템이 더 있기 때문에 전달 속도가 빠르지 않다는 점
- 기존에는 대규모 데이터(단건당 수MB 이상) 보다는 간단한 이벤트(수KB정도) 를 전송하는 데 사용되었다.
    - 즉 이전에는 속도나 용량보다는 신뢰성 보장에 중점을 두었다.
        - kafka의 경우는 성능의 단점을 극복하기 위해 메시지 교환 전달의 신뢰성 관리를 프로듀서와 컨슈머 쪽으로 넘기고 부하가 많이 걸리는 교환기 기능 역시 컨슈머가 만들 수 있게 했다.
            - 메시지 시스템은 메시지 전달 성능에만 집중시켜 성능 문제 해결

## 흐름

1. 프로듀서가 새로운 메시지를 카프카로 전송
2. 프로듀서가 보낸 메시지가 카프카에 토픽(컨슈머 큐)로 도착해 저장된다.
3. 컨슈머가 카프카 서버에 접속해서 새로운 메시지를 가져간다.

이를 보면 프로두셔나 컨슈머가 서로에 관계 없이 메시지를 전송하거나 가져온다.

## 카프카의 특징

그래서 기존 메시징 시스템이랑 이 카프카가 어떻게 다를까?

- 프로듀서와 컨슈머의 분리
    - 메시징을 보내는 역할과 받는 역할이 완벽하게 분리된 pub/sub 방식
        - 이게 막 모니터링 서버, 로그분석 서버, 트랙킹 서버, 데이터저장 서버 이런 식으로 여러 서버가 나뉘어 있는 경우 기존의 메세지 방식보다 훨씬 간단해진다.
            - 이전에는 하나의 서버에서 각각에 여러곳 보내야 했는데, 카프카를 쓰면 보내는 곳은 보내는 데에, 받는 곳은 받는 데에 집중하면 되기 때문
        - 또 받는 쪽이나 보내는 쪽의 상태에는 고민할 필요도 없다.
        - 서버가 추가되는 경우도 다른 곳에 대해 고민할 필요가 없어진다.
- 멀티 프로듀서, 멀티 컨슈머
    - 카프카는 하나의 토픽(프로듀서와 컨슈머들이 카프카로 보낸 자신들의 메시지를 구분하기 위한 네임)에 여러 프로듀서 혹은 컨슈머가 접근 가능하다.
        - 한 프로듀서가 한 토픽에만 메시지를 보내는게 아니라 여러 토픽으로 보낼 수 있음
        - 반대로 한 컨슈머도 여러 토픽에서 메시지를 가져올 수 있다.
    - 이렇게 멀티 프로듀서, 멀티 컨슈머를 구성할 수 있기 때문에 카프카는 중앙 집중형 구조로 구성할 수 있게 된다.
- 디스크에 메시지 저장
    - 기존 메시징 시스템과 가장 다른 특징 중 하나!!
    - 메시지를 디스크에 저장하고 유지한다.
    - 카프카는 컨슈머가 메시지를 읽어 가도 일정 시간 동안 디스크에 메시지를 저장한다.
        - 일반적인 메시징 시스템은 컨슈머가 메시지를 읽어가면 큐에서 바로 메시지를 삭제함
        - 컨슈머 처리가 늦어지더라도 메시지의 손실이 없다.
    - 멀티 컨슈머의 경우도 카프카에 메시지가 디스크로 저장되어 있기 때문에 가능한 것.
    - 메시지가 디스크에 저장되어 있기 때문에 메시지 손실이 없음
- 확장성
    - 하나의 카프카 클러스터는 3대의 브로커(카프카 애플리케이션이 설치되어 있는 서버 혹은 노드)로 시작해 수십 대의 브로커로 확장 가능
        - 확장은 카프카 서비스의 중단 없이 온라인 상태에서 작업 가능
- 높은 성능
    - 내부적으로 분산 처리, 배치 처리 등 다양한 기법을 사용한다.

## 카프카의 확장과 발전

- SOA(Service Oriented Architecture) 의 핵심 구성요소 중 하나인 ESB(Enterprise Service Bus) 를 쉽게 구현할 수 있게 되었다.
    - ESB의 철학은 다음과 같다.
        - 다양한 시스템과 연동하기 위한 멀티 프로토콜과 데이터 타입 지원
        - 느슨한 결합을 위한 메시지 큐 지원
        - 정기적으로 데이터를 가져오는 대신 이벤트 기반 통신 지향
    - 다양한 데이터 센터의 로깅/미터링/이벤트 데이터 등을 연결해서 가져올 수 있게 해서 모든 데이터를 연결해서 가져갈 수 있는 형태로 발전
        - 즉, 빅데이터 분석과 머신러닝 플랫폼을 만드는 데에 중요한 요소가 되었다.
    - 메시징 연결을 넘어 실제로 실시간 분석까지 할 수 있는 분석 시스템으로 진화했다.
