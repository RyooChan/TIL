# study015
###### tags: `Tag(가상 면접 사례로 배우는 대규모 시스템 설계 기초)`

구글 드라이브 서비스 (파일 저장 및 동기화 서비스) 설계

* 문서, 사진, 비디오, 기타 파일을 클라우드에 보관
* 해당 파일은 컴퓨터 스마트폰 등 어떤 단말에서도 이용 가능
* 보관된 파일은 친구, 가족 등과 공유 가능

## 1단계 문제 이해 및 설계 범위 확정

설계 범위는 다음과 같다.

* **파일 업로드/다운로드, 파일 동기화, 알림 기능** 지원
* 모바일 앱, 웹 앱 모두 지원해야 한다.
* 암호화는 필요하다
* 파일 크기는 10GB제한
* DAU 10M(천만명)

다음 기능의 설계에 집중한다.

* 파일 추가
* 파일 다운로드
* 여러 단말에 파일 동기화. 
    * 한 단말에서 파일을 추가하면 다른 단말에도 자동으로 동기화
* 파일 갱신 이력 조회
* 파일 공유
* 파일이 편집되거나 삭제되거나 새롭게 공유되었을 때 알림 표시

해당 기능적 요구사항 이외에 비-기능적 요구사항의 이해도 중요하다

* 안정성
    * 저장소 시스템에서 안정성은 아주 중요하다. 데이터 손실은 발생하면 안된다.
* 빠른 동기화 속도
    * 파일 동기화는 빨리 되어야한다.
* 네트워크 대역폭
    * 네트워크 대역폭을 불필요하게 많이 소모하면 안된다. 특히 모바일에서는
* 규모 확장성
    * 대규모 트래픽의 처리가 가능해야 한다.
* 고가용성
    * 장애가 발생하거나 끊겨도 계속 사용 가능하게

### 개략적 추정치

* 가입 사용자는 오천만명, DAU 천만명
* 모든 사용자에게 10GB무료 저장소 할당
* 매일 각 사용자가 평균 2개의 파일을 업로드하고, 각 파일의 평균 크기는 500KB
* 읽기:쓰기 비율은 1:1
* 필요한 저장공간 총량 = 5천만 * 10GB = 500페타바이트
* 업로드 API QPS = 1천만 * 2회업로드/24시간/3600초 = 240정도
* 최대 QPS = QPS*2 = 480

## 2단계 개략적 설계안 제시 및 동의 구하기

서버 한대부터 시작해서 천만 사용자 지원이 가능한 시스템으로 발전시켜 나가기.
먼저 서버 한대로 시작해 보자

* 파일 업로드/다운로드 처리를 위한 웹서버
* 사용자 데이터, 로그인 정보, 파일 정보 등의 메타데이터를 보관할 DB
* 파일을 저장할 저장소 시스템. 파일 저장을 위해 1TB공간 사용

