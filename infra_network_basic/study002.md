
## 네트워킹

네트워크를 통해 장비들은 서로 통신할 수 있게 되며, 이를 통해 정보와 자원의 공유가 가능하다.

이 네트워크의 이해에 있어 가장 중요하고 기반이 되는 것이 바로 OSI7계층이다.

OSI7계층은 국제표준화기구(ISO)가 발표한 네트워크 통신 모델로, 네트워크 프로토콜이 통신하는 구조를 7개의 계층으로 분리하여 각 계층간 상호 작동하는 방식을 정해 놓은 것이다.
신뢰성 있고, 원할한 통신을 수행하기 위해 모든 장비들이 지켜야 하는 통신 규약이기에 모든 컴퓨터 및 네트워크 장치는 OSI참조 모델을 참고하여 만들어진다.

![](https://i.imgur.com/MaXS4nj.png)

이게 TCP/IP 4계층에 비해 올드하고 이론적인게 아니냐? 할 수 있지만 가장 기초적이고 근본적인 방식이다.

이 OSI7계층을 참조하여 네트워크의 제작을 진행한다.

1~3 계층이 Hardware 계층, 7~4 계층이 Software 계층이다.

### 7계층 (Application)

가장 꼭대리에 있고, 사용자와 직접 상호하는 Application단이 해당된다.

브라우저 / 메신저 등등이 여기 해당된다.


### 6계층 (Presentation)

7계층에서 구동된 application에 관하여 네트워크와 application간의 데이터 변환(예를 들어 인코딩), 암호화/복호과 등등이 이루어진다.


### 5계층 (Session)

내 컴퓨터가 다른 컴퓨터/서버와 통신을 위한 세션을 만드는 단계이다.

SSH 프로토콜과 같은 경우도 5계층에 해당된다.


### 4계층 (Transport == 전송계층)

데이터를 전송하는 것을 조율해준다.

그래서 보내고자 하는 데이터의 용량/속도/목적지 등을 처리한다.

4계층에서 송/수신지의 포트번호의 인지가 가능하다. → 서비스의 구분이 가능하다.

ex) 80(아파치), 21(FTP서비스) 등의 구분이 가능하다.

그래서 4계층에 해당되는 장비인 L4스위치에서는 서비스 별로 그룹을 만들어 부하를 분산시키는 로드 밸런스 작업의 수행이 가능하다.


### 3계층 (Network)

패킷을 어디로 보낼지 Routing하는 작업이 이루어진다.


#### packet

3계층에서 데이터를 부르는 용칭이다.

말 그래도 오고가는 데이터를 packet으로 생각하면 된다.



#### routing

패킷을 어디를 통해 보내야 하는지, 그 길을 찾아가는 것이다.



### 2계층 (Data Link)

MAC주소를 기반으로 통신이 이루어진다.

참고로 여기서는 Data를 Frame이라고 부른다.



#### MAC주소

주민번호처럼 네트워크가 가지는 고유의 주소이다.



### 1계층 (physical == 물리계층)

통신을 위한 전기적 신호, 그리고 케이블이 여기 해당된다.



---



## LAN - 독립적인 네트워크 공간 == 근거리통신망(Local Area Network)

특정 지역/공간에서만 제공되는 근거리 통신망이다.



## 통신을 위한 요소 - IP와 MAC주소

장비 간 데이터의 전송을 위해 서로 통신하기 위한 주소가 필요하다.

* MAC 주소
    * 전세계에서 유일한 하드웨어(NIC)`물리적 주소`이다.
    * 제조업체에서 장비를 제작 시 할당되며, 불가변적이다.
* IP주소
    * 네트워크 연결을 위해 제공되는 `논리적 주소`이다.
    * IP를 할당하는 주체(ISP : 인터넷 회사 or Admin)에 따라 주소가 가변적으로 변경될 수 있음


그럼 MAC주소는 왜 필요할까??

일반적으로 우리는 IP주소만을 가지고 목적지를 찾아낼 수 없다.
IP주소는 가변적인 주소이기 때문이다.

예를 들어 오늘 - 내일의 IP주소가 다를 수 있기 때문이다.

그렇기 때문에 기기 간 내부 통신을 진행할 때에 IP주소를 통해 불변하는 주소인 MAC주소를 알아내려 한다. (이를 ARP라고 한다.)

OSI 7계층과 비교하면 IP가 해당되는 3계층 레벨을 MAC주소가 해당되는 2계층 레밸로 바꾸어 주는 주소 해석 프로토콜이라 볼 수 있다.

IP는 통신을 필요로 하는 각종 장비에 연결되어 네트워킹을 도와주는 요소지만. 장비에 붙는 IP는 언제든지 변경될 수 있다.

그렇기 때문에 절대로 변경되지 않는 MAC주소를 사용하며, 이 MAC주소를 찾기 위해 IP는 내부에서 검색을 진행한다.(ARP)

그리고 <IP주소,MAC주소 쌍> 을 저장해두는 곳이 ARP Table이다.

이 ARP Table은 IP주소를 통해 MAC주소를 가져와서 저장하는 것인데, 그 이유는 다음 번에 다시 통신을 진행할 때에 바로 MAC주소를 가져올 수 있도록 하기 위함이다.

---

##  IP주소

IP주소는 8자리의 이진수를 4개의 그룹으로 묶어 구성된다.
다만

![](https://i.imgur.com/6HHKuJ3.png)

이런 식으로 0과 1로만 이루어진 숫자는 가독성이 낮을 수 있다.

![](https://i.imgur.com/mI4LzU9.png)

따라서 이런 식으로 10진수를 통해 보기 쉽게 만들어준다.

이 숫자는 만들어 낼 수 있는 크기에 한계가 있다. (2^32개)

근데 이 IP는 전 세계의 IP들이 각각 분배해서 사용하고 있다.

그러면 IP의 개수가 부족하지 않을까??

### 공인 IP와 사설 IP

이러한 문제를 해결하기 위해 나온 것이 바로 private IP(사설 IP)이다.

IP는 용도에 따라 `공인`  / `사설`  두 가지로 나뉜다.

공인 IP는 인터넷 사용자의 로컬 네트워크를 식별하기 위해 ISP에서 제공하는 **전 세계적으로** 고유한 주소이다.

공인 IP는 인터넷 상에서 디바이스들이 서로 인식하고 통신할 수 있게 해주는 고유의 주소이다.
즉, 유한한 IP개수를 가지고 있으며 유료로 구매해서 사용한다.
언제 어디서든 누구나 함께 통신할 수 있는 `public Network`이다.
사설 IP는 집이나 사무실 등 한정된 공간 내에서 통신하기 위한 **특정 구역** 내 고유 주소이다.

일반 가정이나 회사내 등에 할당된 가상 IP이다.
이 가상 IP만을 가지고 외부와 통신할 수는 없다.
외부와의 통신을 위해서는 라우터가 가지고 있는 공인 IP를 공유한다.
내부 → 외부 : 내부 PC는 라우터의 공인 IP를 사용하여 인터넷으로 데이터 전송
외부 → 내부 : 인터넷은 라우터로 통신, 라우터가 목적지 사설 IP로 데이터 전송
특정 조직 내에서만 함께 통신할 수 있는 `private Network`이다.

### Network Address Translation(NAT)

만약 PC가 엄청 많다면 하나하나 Public IP를 할당해 주는건 곤란할 것이다.
그렇기 때문에 회사처럼 여러 컴퓨터가 연결되는 경우 NAT를 활용해 준다.

![](https://i.imgur.com/Fq3KV7l.png)

![](https://i.imgur.com/iCAUBgu.png)

각기 다른 private IP(사설 IP)를 가진 PC들이 NAT를 통해서 하나의 같은 Public IP의 다른 Port를 가지고 통신하는 것이다.

일반적으로 회사는 소수의 NAT IP를 가지고 내부 PC가 외부 인터넷에 접속하도록 하고 있다.

NAT의 또 하나의 장점은 보안에서 얻을 수 있다.
특별히 따로 설정한 것이 아니라면, 일반적으로 NAT는 외부 → 내부로의 접속이 차단된다.
그렇기 때문에 보안 위협으로부터 보다 안전한 환경의 구축이 가능하다.

즉, NAT는 여러 사설 IP들이 하나의 공인 IP를 통해 외부와 통신할 수 있도록 도와주는 주소 변환 서비스이다.

그래서 내부에서는 서로 다른 IP를 사용하는 것 같지만, 외부에서 볼 때에는 동일한 IP를 쓰는 것으로 보이게 될 것이다.


## 다양한 통신 방법

![](https://i.imgur.com/vpSogFb.png)

네트워크 통신 방법에는 다양한 방법이 존재하는데, 이 중 3가지에 대해 알아본다.

### Unicast

유니캐스트는 네트워크 상에서 널리 사용되는 방식이다.

> 특정 목적지로만 프레임을 전달하기 때문에(1대1 통신 방식이다) 다른 장비의 성능을 저하시키지 않는다.

![](https://i.imgur.com/06iewTq.png)

여기서 192.168.0.101이 자신과 같은 IP대역을 사용하는 모든 PC에 데이터를 전달했다.

프레임에는 데이터를 전달받아야 하는 목적지의 MAC서버가 써있다.

그래서 받은 서버에서는 데이터를 받은 이후, 자신의 MAC주소와 적힌 MAC주소가 일치하는지 확인하고 일치하지 않는 경우 프레임을 버리고 일치하는 경우에만 CPU로 프레임을 올려보낸다.

이런 식으로 프레임을 전달 받아야 하는 특정 목적지에서만 CPU로 데이터를 전달하기 때문에 다른 서버에서는 부하가 생기지 않게 되고, 이는 곧 다른 장비의 성능을 저하시키지 않는다는 장점을 가져가게 된다.


### BroadCast

![](https://i.imgur.com/xxtrXF7.png)

같은 네트워크 대역(브로드케스트 도메인)의 모든 장비에 데이터를 보내는 통신이다.

모든 장비는 이 패킷을 받아 CPU로 데이터를 전송하고, 이에 따라 Interrupt가 발생하게 된다.

그렇기 때문에 성능이 떨어지게 된다.
그럼 이거 왜쓸까??


만약 처음에 통신하고자 하는 PC가 있을 때에, 상대 PC의 MAC주소를 알 수 없다.
그래서 상대방의 MAC주소를 알아보기 위해서는 앞에서 배운 ARP request를 진행해야 한다.
이 때에 ARP요청이 바로 broadcast를 통해 전송된다.
같은 대역에 속하는 PC들에게 "내가 이 PC를 찾고 있으니, 니가 이거면 응답해라"  이런 식이다.

> 위의 설명에서 알 수 있듯, BroadCast 통신은 1회성이 아니라 주기적으로 이루어지는 통신이다.


### MultiCast

한번의 송신만으로 특정 그룹에 속한 장비 여럿에 메세지를 보낼 수 있는 방식이다.

![](https://i.imgur.com/oG09Edb.png)

한번의 송신으로 여러 개의 장비에 보낼 수 있는 이유는 스위치/라우터와 같은 네트워크 장비가 패킷에 복사본을 전송해야 하는 만큼 복사해서 대신 전송하기 때문이다.

이 방식은 내가 메세지를 보내고 싶어하는 장비에만 패킷을 보내기 때문에 수신 그룹이 아닌 다른 장비에는 interrupt를 발생시키지 않는다는 장점이 있다.

### 같은 네트워크? 다른 네트워크?

같은 네트워크 대역 안에서는 일반적으로 장비들 끼리의 통신이 허용되지만, 다른 네트워크 대역에 존재하는 장비와는 특별히 세팅을 따로 하지 않은 이상 통신을 할 수 없다.

이 때 같은/다른 네트워크의 기준은 서브넷(Subnet)이 같은지에 따라 구분된다.

![](https://i.imgur.com/3uWmRIa.png)

같은 대역에서의 통신과 다른 대역끼리의 통신 간의 루틴 차이는 이와 같다.

1의 경우처럼 같은 네트워크 대역에 있는 경우 서버 A가 서버 B로 가는 길을 알기 때문에 따로 장비가 없이 통신이 가능하다.

2의 경우처럼 다른 네트워크 대역에 있는 경우 서버 A가 서버 B로 가는 길을 모르기 떼문에 길을 알려줄 친구인 Router 가 필요하다.

라우터는 서로 다른 대역간 통신을 추가할 때에 어디로 가야 하는지 알려주는 layer3의 대표적인 장비이다.

#### Subnetting

Subnetting은 하나의 네트워크를 서로 다른 여러 대역으로 분할하는 것을 뜻한다.

여러 대역으로 IP대역을 분할하면 IP낭비를 줄일 수 있으며 용도 별 분리를 통해 보안을 한층 더 강화할 수 있다.

아래와 같은 예시가 있다.

> Q : 사무실에서 192.168.0.0/24 대역의 IP를 할당받았을 때에 100명의 근로자가 서브넷 없이 사용하게 된다면

> A : 256개의 IP중 (192.168.0.0 ~ 192.168.0.255) 150개 정도의 IP가 낭비되게 된다.

그렇다면 이거를 서브넷팅을 한다면?

> Subnetting : 192.168.0.0/25  => 192.168.0.0 ~ 192.168.0.127 //// 192.168.128.0/25 => 192.168.128.0 ~ 192.168.128.255

> A : 100명의 근로자에게 IP를 할당하고, 나머지 IP를 아낄 수 있다.

##### 그럼 Subnetting을 어떻게 할 수 있는 건데?

먼저 네트워크 | 호스트 주소의 개념에 대해 알아보고, 서브넷 마스크가 무엇인지 배워본다.

![](https://i.imgur.com/xWIcLwX.png)

→ 이 파란색 24개의 숫자가 동일한 경우 같은 대역을 의미한다는 것을 뜻한다. (이 24개의 비트는 네트워크 부분이라고 부른다) 즉, 24개의 네트워크 부분은 라우터를 거치지 않고 통신이 가능하다. == 브로트캐스트 영역

→ 나머지 8개의 비트는 Host부분이다.같은 브로드캐스트 영역 안에 있는 각각의 서버 혹은 장비를 뜻한다.

#### 네트워크 대역 구분 Summary

아래 내용에 해당되는 표현은 모두 동일한 네트워크에 속한다는 바를 의미한다.

![](https://i.imgur.com/My0a5kn.png)

### 스위치

스위치는, 여러 장비를 연결하여 하나의 네트워크를 구성할 수 있도록 도와주는 장비이다.

우리가 사용하는 각종 디바이스들은 이 스위치를 통해 서로 통신하고 정보를 공유할 수 있게 된다.

스위치는 다양한 기능을 갖고 있는데, 이 중 가장 대표적인 네 가지 기능을 알아본다.

![](https://i.imgur.com/AuoKumx.png)

#### 주소 학습 기능 | Learning

스위치는 자신과 연결된 장비가 통신을 위해 프레임을 내보낼 때에 그 장비의 MAC주소를 읽고, 자신의 MAC Address table에 저장한다.

이렇게 정보가 차곡차곡 쌓이게 되면, 나중에 어떤 장비가 누군가와 통신하고자 할 때 이 MAC address table을 참고하여 데이터를 보낼 수 있을 것이다.

#### 프레임 전달 | Flooding

목적지 MAC주소를 모를 경우, 들어온 포트를 제외한 나머지 모든 포트로 뿌린다. → 브로드캐스팅을 통해 MAC주소 알아오는것

#### 목적지로 전달 | Forwarding

목적지의 MAC주소를 알고 있으면서, 해당 목적지가 다른 세그먼트에 존재할 시 해당 포트로만 프레임 전달.

#### 프레임 전달 차단 | Filtering

목적지가 아닌 다른 세그먼트 영역으로는 프레임이 전달되지 않도록 필터링한다.
포워딩이 가능한 이유는 이러한 필터링 기능이 지원되기 때문이다.

---

### 라우터(L3 Switch)

요즘은 L3스위치에서도 라우팅 기능이 제공되기 때문에 L3스위치라고 많이 부른다.
-> 완전 똑같은건 아니고 차이가 있기는 한데...거의 동일해서 요즘은 동일하게 쓴다 한다.

서로 다른 네트워크 간 통신을 가능하게 해주는 라우터는 통신을 위한 길을 찾아주는 **경로 결정 역할**과 **스위칭 기능**을 제공한다.

![](https://i.imgur.com/jyG80nl.png)

#### 경로 결정

내가 속한 네트워크 대역과 다른 네트워크 대역에 있는 장비와 통신하기 위해서는 통신을 위한 경로를 알아야 하고, 이것을 도와주는 것이 라우터이다.

라우터는 라우팅 알고리즘을 사용해서 내가 전달하고자 하는 패킷을 가장 최적의 경로를 찾아내고, 이것을 라우팅 테이블에 저장한다.

#### 스위칭

앞서 패킷을 전달할 경로를 찾아내면 목적지까지 패킷을 전달해야 한다.

패킷 경로를 지정한 후 보내는 작업을 스위칭이라고 한다.

---



### 네트워크 가상화

스위치, 라우터와 같은 물리적 장비들이 존재한다.

그런데 유저가 늘어난다고 해서, 이러한 물리적 장비를 계속해서 구축하는 것은 불가능하다.

![](https://i.imgur.com/kBSJho5.png)


그래서, 하드웨어 적으로만 구축이 가능했던 네트워크 기술을 소프트웨어를 통해 구축을 가능하도록 한 것이 네트워크 가상화이다.

Switch, Router, Firewall 등의 네트워크 장비를 가상화한다.

단순히 물리적장비만 사용할 때와 비하여 장비를 아낄 수 있다는 장점이 있다.

하나의 스위치를 여러 개의 스위치처럼 네트워크 대역을 분리하여 사용할 수 있도록 도와주는 VLAN 또한 네트워크 가상화 기술에 해당한다.

#### VLAN - Network Overlay기술

VLAN은 사실 On-Premise에서 많이 사용되는 기술로, 가상 LAN을 만들 수 있도록 도와주는 기술이라 보면 편하다.

> 그린팩토리라는 사무실, 그레이팩토리라는 사무실을 가지고 있고, 이 사무실들이 모두 3개의 네트워크 대역을 이용해야 한다고 생각해본다.

우리가 LAN을 물리장비만을 통해 구축할 수 있다고 가정한다면 (VLAN이 없다면)

![](https://i.imgur.com/3afTdsT.png)

각 사무실마다 3개의 네트워크망을 제공하기 위해서 3대의 스위치를 다르게 구축하고 연결해야 할 것이다.

![](https://i.imgur.com/7p6ycil.png)

VLAN이 지원되는 스위치와 라우터를 사용하면 하나의 링크만으로 여러개의 네트워크 정보를 같이 실어 내보낼 수 있다.

그리고 스위치에서는 이러 여러 브로드캐스트 영역을 나누어서 사용할 수 있다.

* Trunk
    * 여러 개의 VLAN을 하나의 링크로 이용할 수 있게 도와주는 기술

#### VXLAN - Network Overlay 기술

VLAN에 eXensible의 X를 더한 것으로, VALN에 확장성과 유연성이 더해진 기술로, 멀티테넌시 환경에서 주로 사용된다.

public cloud은 다양한 사람들이 사용하기 때문에 대규모 네트워크 프로비저닝 외에도 회원마다 분리된 네트워크와 별도의 보안환경을 구축할 수 있어야 한다.

또 물리적 환경에 있어서도 제약이 없어야 하고, 여러 데이터 센터 간 연결도 가능해야 할 것이다. 

그래서 나온것이 바로 VXLAN이다.

VXLAN을 이용하면 물리적인 제약이 없어진다.

일반적으로 네트워크 대역이 다른 장비는 서로 연결할 수 없다고 했는데, VXLAN을 사용하면 이런 제약에 관해 고민할 필요가 없어진다.

다른 데이터 센터에 위치한 다른 서브넷으로도 얼마든지 데이터를 보낼 수 있기 때문이다.

![](https://i.imgur.com/XzeLaSw.png)

* VXLAN은 Encapsulation protocol이다.
* Mulicast 통신을 기반으로 Flood&Learn 방식으로 동작한다.
* VNI(Segment ID)를 통해 Layer2의 서브넷 관리
* VTEP는 VXLAN Tunneling End Point의 약자로, 실제 패킷의 encapsulation 및 decapsulation이 진행되는 곳이다.
* End Point(서버 등)에서는 위에서 VXLAN으로의 통신여부 등은 전혀 모른다.

### VPN이 무엇일까??

Virtual Private Network(사설망)이다.

여기에는 IPsec VPN 과 SSL VPN  두가지가 있는데,

#### IPsec VPN

네트워크망과 망을 연결할 때에 사용한다.

예를 들어, 우리 회사의 네트워크 망과 다른 망을 연결하는 것이다.

#### SSL VPN

인가받은 클라이언트들이 특정 네트워크에 접근하기 위해 사용하는 것이다.

우리가 사내 인트라넷에 붙을 때에도 SSLVPN을 사용한다.













